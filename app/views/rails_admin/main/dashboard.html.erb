<% content_for :title, I18n.t('dashboard.title') %>
<div class="dashboard-container">
  <!-- Key Metrics -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value"><%= @outstanding_count %></div>
      <div class="stat-label"><%= I18n.t('dashboard.outstanding_invoices') %></div>
    </div>
    <div class="stat-card">
      <div class="stat-value">£<%= sprintf("%.2f", (@outstanding_amount || 0).to_f).gsub(/(\d)(?=(\d{3})+(?!\d))/, '\1,') %></div>
      <div class="stat-label"><%= I18n.t('dashboard.outstanding_amount') %></div>
    </div>
    <div class="stat-card">
      <div class="stat-value"><%= @overdue_count || 0 %></div>
      <div class="stat-label"><%= I18n.t('dashboard.overdue') %></div>
    </div>
    <div class="stat-card">
      <div class="stat-value">£<%= sprintf("%.2f", (@overdue_amount || 0).to_f).gsub(/(\d)(?=(\d{3})+(?!\d))/, '\1,') %></div>
      <div class="stat-label"><%= I18n.t('dashboard.overdue_amount') %></div>
    </div>
    <% 
      require 'cgi'
      # Generate random IDs for each filter (RailsAdmin format)
      id1 = rand(10000..99999).to_s
      id2 = rand(10000..99999).to_s
      id3 = rand(10000..99999).to_s
      
      # Build RailsAdmin filter parameters manually to handle array format
      params = []
      params << "f%5Bincluded_vat_amount%5D%5B#{id1}%5D%5Bo%5D=between"
      params << "f%5Bincluded_vat_amount%5D%5B#{id1}%5D%5Bv%5D%5B%5D=500"
      params << "f%5Bincluded_vat_amount%5D%5B#{id1}%5D%5Bv%5D%5B%5D=500"
      params << "f%5Bincluded_vat_amount%5D%5B#{id1}%5D%5Bv%5D%5B%5D="
      params << "f%5Bfinal_status%5D%5B#{id2}%5D%5Bo%5D=not_like"
      params << "f%5Bfinal_status%5D%5B#{id2}%5D%5Bv%5D=PAID"
      params << "f%5Bfinal_status%5D%5B#{id3}%5D%5Bo%5D=not_like"
      params << "f%5Bfinal_status%5D%5B#{id3}%5D%5Bv%5D=#{CGI.escape('voided + email sent')}"
      params << "model_name=invoice"
      params << "q%5Bs%5D=included_vat_amount+desc"
      params << "sort=included_vat_amount"
      params << "sort_reverse=true"
      
      outstanding_url = rails_admin.index_path(model_name: 'invoice') + '?' + params.join('&')
    %>
    <a href="<%= outstanding_url %>" class="stat-card stat-card-link">
      <div class="stat-value">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 18V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9 15H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-label">OUTSTANDING invoices</div>
    </a>
    <a href="<%= rails_admin.index_path(model_name: 'invoice', q: { s: 'created_at desc' }) %>" class="stat-card stat-card-link">
      <div class="stat-value">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="15" r="1" fill="currentColor"/>
          <path d="M12 12V14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="stat-label">RECENT invoices</div>
    </a>
  </div>
</div>
